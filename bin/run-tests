#!/bin/bash

set -eux

export NO_COLOR=1
project=$(basename $(pwd))

system_python=~/code/test/.venv/bin/python
fix_errors_file=~/code/test/python/fix_error_messages.py
fix_errors="$system_python $fix_errors_file"

ruff check $@  --select B,E,F,I $project test* | $fix_errors
ruff format | $fix_errors
pytest -vvvvv | $fix_errors
ty check $project | $fix_errors

version=$(cat .python-version)
version=${version//./}
find test $project -name \*.py | xargs pyupgrade --py${version}-plus

coverage run $(which pytest)
coverage html
